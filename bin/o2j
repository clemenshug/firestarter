#!/usr/bin/env python3

import argparse
import csv
import pathlib
import o2jobber
from o2jobber.util import parse_csv

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "job_type",
        choices = list(o2jobber.job_types.keys()),
        help = "Type of job, one of " + ", ".join(o2jobber.job_types.keys()),
    )
    parser.add_argument(
        "jobs",
        nargs = "+",
        type = pathlib.Path,
        help = "Job description .yaml or .csv files",
    )
    parser.add_argument(
        "--no-submit",
        action = "store_true",
        help = "Only create run directory structure and files, don't submit",
    )
    args = parser.parse_args()
    job_class = o2jobber.job_types[args.job_type]
    for p in args.jobs:
        if args.p.suffix == "yaml":
            with open(p, "r") as f:
                j = o2jobber.DgeBcbioJob.from_yaml(f)
        elif args.p.suffix == "csv":
            csv_contents = parse_csv(args.p)
            

        j.prepare_run()
        if not args.no_submit:
            j.submit_run()
